2025-08-30 08:16:17,822 - chatbot_logger - INFO - Initializing chatbot backend...
2025-08-30 08:16:17,822 - chatbot_logger - INFO - metadata.json found. Clearing existing vector store before re-initialization.
2025-08-30 08:16:17,822 - chatbot_logger - INFO - Vector store cleared.
2025-08-30 08:16:17,822 - chatbot_logger - INFO - Existing vector store cleared based on metadata.json presence.
2025-08-30 08:16:18,183 - chatbot_logger - DEBUG - Initialized 5 KB chunks.
2025-08-30 08:16:18,183 - chatbot_logger - INFO - KB chunks initialized/re-initialized.
2025-08-30 08:16:18,198 - chatbot_logger - DEBUG - Loaded Profile for test_user_123:
{
  "user_id": "test_user_123",
  "demographics": {},
  "conditions": [],
  "preferences": {
    "tone": "genuine",
    "length": "short",
    "avoid_topics": []
  },
  "goals": [],
  "triggers": [],
  "therapeutic_styles": [
    "CBT",
    "Mindfulness"
  ],
  "timezone": "UTC",
  "safety_plan": {
    "contacts": [],
    "grounding_preference": ""
  },
  "consents": {
    "data_use": true,
    "crisis_detection": true
  },
  "updated_at": "2025-08-29T23:56:11.473207"
}
2025-08-30 08:16:31,045 - chatbot_logger - DEBUG - Detected User Emotion: fear (Scores: {"fear": 0.9711493253707886, "surprise": 0.016161758452653885, "sadness": 0.004925637040287256, "neutral": 0.004028542898595333, "joy": 0.001850398606620729, "anger": 0.001583067118190229, "disgust": 0.0003013673413079232})
2025-08-30 08:16:32,235 - chatbot_logger - DEBUG - Profile Update (Option 2): Added new goal 'manage anxiety' for user test_user_123.
2025-08-30 08:16:32,235 - chatbot_logger - DEBUG - Profile Update (Option 2): Added new condition 'anxiety' for user test_user_123.
2025-08-30 08:16:32,235 - chatbot_logger - INFO - User test_user_123 profile will be updated with new goals/conditions.
2025-08-30 08:16:32,601 - chatbot_logger - DEBUG - Profile Update (Option 3): Added new avoid topic 'anxiety' for user test_user_123 due to negative emotion.
2025-08-30 08:16:32,601 - chatbot_logger - INFO - User test_user_123 profile will be updated with new avoid topics: ['anxiety']
2025-08-30 08:16:32,601 - chatbot_logger - DEBUG - Final profile_patch for user test_user_123: {
  "goals": [
    "manage anxiety"
  ],
  "conditions": [
    "anxiety"
  ],
  "preferences": {
    "tone": "genuine",
    "length": "short",
    "avoid_topics": [
      "anxiety"
    ]
  }
}
2025-08-30 08:16:32,601 - chatbot_logger - INFO - User test_user_123 profile updated with aggregated changes: {'goals': ['manage anxiety'], 'conditions': ['anxiety'], 'preferences': {'tone': 'genuine', 'length': 'short', 'avoid_topics': ['anxiety']}}
2025-08-30 08:16:32,648 - chatbot_logger - DEBUG - Updated Profile for test_user_123:
{
  "user_id": "test_user_123",
  "demographics": {},
  "conditions": [
    "anxiety"
  ],
  "preferences": {
    "tone": "genuine",
    "length": "short",
    "avoid_topics": [
      "anxiety"
    ]
  },
  "goals": [
    "manage anxiety"
  ],
  "triggers": [],
  "therapeutic_styles": [
    "CBT",
    "Mindfulness"
  ],
  "timezone": "UTC",
  "safety_plan": {
    "contacts": [],
    "grounding_preference": ""
  },
  "consents": {
    "data_use": true,
    "crisis_detection": true
  },
  "updated_at": "2025-08-30T08:16:32.601526"
}
2025-08-30 08:17:06,655 - chatbot_logger - DEBUG - Detected User Emotion: joy (Scores: {"joy": 0.6949449181556702, "fear": 0.24427704513072968, "anger": 0.03658556193113327, "sadness": 0.013982812874019146, "surprise": 0.005774384364485741, "neutral": 0.0031445948407053947, "disgust": 0.0012906844494864345})
2025-08-30 08:17:07,222 - chatbot_logger - DEBUG - No profile updates detected for user test_user_123 this turn.
2025-08-30 08:17:07,222 - chatbot_logger - DEBUG - Updated Profile for test_user_123:
{
  "user_id": "test_user_123",
  "demographics": {},
  "conditions": [
    "anxiety"
  ],
  "preferences": {
    "tone": "genuine",
    "length": "short",
    "avoid_topics": [
      "anxiety"
    ]
  },
  "goals": [
    "manage anxiety"
  ],
  "triggers": [],
  "therapeutic_styles": [
    "CBT",
    "Mindfulness"
  ],
  "timezone": "UTC",
  "safety_plan": {
    "contacts": [],
    "grounding_preference": ""
  },
  "consents": {
    "data_use": true,
    "crisis_detection": true
  },
  "updated_at": "2025-08-30T08:16:32.601526"
}
2025-08-30 08:18:03,457 - chatbot_logger - DEBUG - Detected User Emotion: surprise (Scores: {"surprise": 0.4582618474960327, "sadness": 0.22767040133476257, "fear": 0.19398556649684906, "neutral": 0.0773940235376358, "joy": 0.023902975022792816, "anger": 0.016557905822992325, "disgust": 0.002227302175015211})
2025-08-30 08:18:04,249 - chatbot_logger - DEBUG - Profile Update (Option 2): Added new goal 'Clarify unknown or uncertain situations' for user test_user_123.
2025-08-30 08:18:04,249 - chatbot_logger - DEBUG - Profile Update (Option 2): Added new condition 'Uncertainty' for user test_user_123.
2025-08-30 08:18:04,249 - chatbot_logger - DEBUG - Profile Update (Option 2): Added new condition 'Apprehension' for user test_user_123.
2025-08-30 08:18:04,249 - chatbot_logger - INFO - User test_user_123 profile will be updated with new goals/conditions.
2025-08-30 08:18:04,249 - chatbot_logger - DEBUG - Final profile_patch for user test_user_123: {
  "goals": [
    "manage anxiety",
    "Clarify unknown or uncertain situations"
  ],
  "conditions": [
    "Apprehension",
    "anxiety",
    "Uncertainty"
  ]
}
2025-08-30 08:18:04,249 - chatbot_logger - INFO - User test_user_123 profile updated with aggregated changes: {'goals': ['manage anxiety', 'Clarify unknown or uncertain situations'], 'conditions': ['Apprehension', 'anxiety', 'Uncertainty']}
2025-08-30 08:18:04,249 - chatbot_logger - DEBUG - Updated Profile for test_user_123:
{
  "user_id": "test_user_123",
  "demographics": {},
  "conditions": [
    "Apprehension",
    "anxiety",
    "Uncertainty"
  ],
  "preferences": {
    "tone": "genuine",
    "length": "short",
    "avoid_topics": [
      "anxiety"
    ]
  },
  "goals": [
    "manage anxiety",
    "Clarify unknown or uncertain situations"
  ],
  "triggers": [],
  "therapeutic_styles": [
    "CBT",
    "Mindfulness"
  ],
  "timezone": "UTC",
  "safety_plan": {
    "contacts": [],
    "grounding_preference": ""
  },
  "consents": {
    "data_use": true,
    "crisis_detection": true
  },
  "updated_at": "2025-08-30T08:18:04.249189"
}
2025-08-30 08:18:23,433 - chatbot_logger - DEBUG - Detected User Emotion: sadness (Scores: {"sadness": 0.7218592762947083, "anger": 0.21905046701431274, "joy": 0.037097033113241196, "surprise": 0.010251335799694061, "fear": 0.0088966628536582, "neutral": 0.0017008305294439197, "disgust": 0.0011444061528891325})
2025-08-30 08:18:24,016 - chatbot_logger - DEBUG - Profile Update (Option 2): Added new goal 'avoiding negative self-talk' for user test_user_123.
2025-08-30 08:18:24,016 - chatbot_logger - INFO - User test_user_123 profile will be updated with new goals/conditions.
2025-08-30 08:18:24,265 - chatbot_logger - DEBUG - Profile Update (Option 3): Added new avoid topic 'bad numbers' for user test_user_123 due to negative emotion.
2025-08-30 08:18:24,265 - chatbot_logger - INFO - User test_user_123 profile will be updated with new avoid topics: ['bad numbers', 'anxiety']
2025-08-30 08:18:24,265 - chatbot_logger - DEBUG - Final profile_patch for user test_user_123: {
  "goals": [
    "manage anxiety",
    "Clarify unknown or uncertain situations",
    "avoiding negative self-talk"
  ],
  "conditions": [
    "Apprehension",
    "anxiety",
    "Uncertainty"
  ],
  "preferences": {
    "tone": "genuine",
    "length": "short",
    "avoid_topics": [
      "bad numbers",
      "anxiety"
    ]
  }
}
2025-08-30 08:18:24,265 - chatbot_logger - INFO - User test_user_123 profile updated with aggregated changes: {'goals': ['manage anxiety', 'Clarify unknown or uncertain situations', 'avoiding negative self-talk'], 'conditions': ['Apprehension', 'anxiety', 'Uncertainty'], 'preferences': {'tone': 'genuine', 'length': 'short', 'avoid_topics': ['bad numbers', 'anxiety']}}
2025-08-30 08:18:24,281 - chatbot_logger - DEBUG - Updated Profile for test_user_123:
{
  "user_id": "test_user_123",
  "demographics": {},
  "conditions": [
    "Apprehension",
    "anxiety",
    "Uncertainty"
  ],
  "preferences": {
    "tone": "genuine",
    "length": "short",
    "avoid_topics": [
      "bad numbers",
      "anxiety"
    ]
  },
  "goals": [
    "manage anxiety",
    "Clarify unknown or uncertain situations",
    "avoiding negative self-talk"
  ],
  "triggers": [],
  "therapeutic_styles": [
    "CBT",
    "Mindfulness"
  ],
  "timezone": "UTC",
  "safety_plan": {
    "contacts": [],
    "grounding_preference": ""
  },
  "consents": {
    "data_use": true,
    "crisis_detection": true
  },
  "updated_at": "2025-08-30T08:18:24.265593"
}
2025-08-30 08:18:35,196 - chatbot_logger - DEBUG - Detected User Emotion: neutral (Scores: {"neutral": 0.8056771159172058, "sadness": 0.09745588153600693, "fear": 0.026156319305300713, "disgust": 0.024317529052495956, "joy": 0.022120824083685875, "anger": 0.016567153856158257, "surprise": 0.007705169264227152})
2025-08-30 08:18:35,873 - chatbot_logger - ERROR - Error during LLM-based goal/condition extraction: Error code: 400 - {'error': {'message': "Failed to call a function. Please adjust your prompt. See 'failed_generation' for more details.", 'type': 'invalid_request_error', 'code': 'tool_use_failed', 'failed_generation': '/tool-use\n{\n  "tool_call": {\n    "id": "pending",\n    "type": "function",\n    "function": {\n      "name": "GoalConditionExtraction"\n    },\n    "parameters": {\n      "properties": {\n        "conditions": ["Uncertainty", "Anxiety"],\n        "goals": ["To feel more prepared", "To reduce stress"]\n      }\n    }\n  }\n}/tool-use'}}
2025-08-30 08:18:35,889 - chatbot_logger - DEBUG - No profile updates detected for user test_user_123 this turn.
2025-08-30 08:18:35,889 - chatbot_logger - DEBUG - Updated Profile for test_user_123:
{
  "user_id": "test_user_123",
  "demographics": {},
  "conditions": [
    "Apprehension",
    "anxiety",
    "Uncertainty"
  ],
  "preferences": {
    "tone": "genuine",
    "length": "short",
    "avoid_topics": [
      "bad numbers",
      "anxiety"
    ]
  },
  "goals": [
    "manage anxiety",
    "Clarify unknown or uncertain situations",
    "avoiding negative self-talk"
  ],
  "triggers": [],
  "therapeutic_styles": [
    "CBT",
    "Mindfulness"
  ],
  "timezone": "UTC",
  "safety_plan": {
    "contacts": [],
    "grounding_preference": ""
  },
  "consents": {
    "data_use": true,
    "crisis_detection": true
  },
  "updated_at": "2025-08-30T08:18:24.265593"
}
2025-08-30 08:18:50,204 - chatbot_logger - DEBUG - Detected User Emotion: sadness (Scores: {"sadness": 0.6748509407043457, "fear": 0.11724056303501129, "disgust": 0.0753604844212532, "neutral": 0.07108581811189651, "anger": 0.05269656702876091, "joy": 0.005070582963526249, "surprise": 0.0036949729546904564})
2025-08-30 08:18:50,790 - chatbot_logger - DEBUG - Profile Update (Option 2): Added new goal 'performance' for user test_user_123.
2025-08-30 08:18:50,790 - chatbot_logger - INFO - User test_user_123 profile will be updated with new goals/conditions.
2025-08-30 08:18:51,098 - chatbot_logger - DEBUG - Profile Update (Option 3): Added new avoid topic 'academic performance' for user test_user_123 due to negative emotion.
2025-08-30 08:18:51,098 - chatbot_logger - DEBUG - Profile Update (Option 3): Added new avoid topic 'fear of failure' for user test_user_123 due to negative emotion.
2025-08-30 08:18:51,098 - chatbot_logger - DEBUG - Profile Update (Option 3): Added new avoid topic 'failure' for user test_user_123 due to negative emotion.
2025-08-30 08:18:51,098 - chatbot_logger - DEBUG - Profile Update (Option 3): Added new avoid topic 'bad marks' for user test_user_123 due to negative emotion.
2025-08-30 08:18:51,098 - chatbot_logger - INFO - User test_user_123 profile will be updated with new avoid topics: ['failure', 'academic performance', 'fear of failure', 'anxiety', 'bad marks', 'bad numbers']
2025-08-30 08:18:51,098 - chatbot_logger - DEBUG - Final profile_patch for user test_user_123: {
  "goals": [
    "manage anxiety",
    "Clarify unknown or uncertain situations",
    "avoiding negative self-talk",
    "performance"
  ],
  "conditions": [
    "Apprehension",
    "anxiety",
    "Uncertainty"
  ],
  "preferences": {
    "tone": "genuine",
    "length": "short",
    "avoid_topics": [
      "failure",
      "academic performance",
      "fear of failure",
      "anxiety",
      "bad marks",
      "bad numbers"
    ]
  }
}
2025-08-30 08:18:51,098 - chatbot_logger - INFO - User test_user_123 profile updated with aggregated changes: {'goals': ['manage anxiety', 'Clarify unknown or uncertain situations', 'avoiding negative self-talk', 'performance'], 'conditions': ['Apprehension', 'anxiety', 'Uncertainty'], 'preferences': {'tone': 'genuine', 'length': 'short', 'avoid_topics': ['failure', 'academic performance', 'fear of failure', 'anxiety', 'bad marks', 'bad numbers']}}
2025-08-30 08:18:51,114 - chatbot_logger - DEBUG - Updated Profile for test_user_123:
{
  "user_id": "test_user_123",
  "demographics": {},
  "conditions": [
    "Apprehension",
    "anxiety",
    "Uncertainty"
  ],
  "preferences": {
    "tone": "genuine",
    "length": "short",
    "avoid_topics": [
      "failure",
      "academic performance",
      "fear of failure",
      "anxiety",
      "bad marks",
      "bad numbers"
    ]
  },
  "goals": [
    "manage anxiety",
    "Clarify unknown or uncertain situations",
    "avoiding negative self-talk",
    "performance"
  ],
  "triggers": [],
  "therapeutic_styles": [
    "CBT",
    "Mindfulness"
  ],
  "timezone": "UTC",
  "safety_plan": {
    "contacts": [],
    "grounding_preference": ""
  },
  "consents": {
    "data_use": true,
    "crisis_detection": true
  },
  "updated_at": "2025-08-30T08:18:51.098239"
}
